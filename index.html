
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padel Academy Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #4834d4, #686de0);
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 1000;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4757;
        }

        .sync-indicator.connected {
            background: #2ed573;
        }

        .sync-indicator.syncing {
            background: #ffa502;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .page {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .page.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #a4b0be, #747d8c);
        }

        .btn-success {
            background: linear-gradient(45deg, #2ed573, #1e90ff);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4757, #ff3838);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .hidden {
            display: none;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: linear-gradient(45deg, #2ed573, #7bed9f);
            color: white;
        }

        .status-pending {
            background: linear-gradient(45deg, #ffa502, #ff6348);
            color: white;
        }

        .status-canceled {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            color: white;
        }

        .status-free-session {
            background: linear-gradient(45deg, #747d8c, #a4b0be);
            color: white;
        }

        .status-package {
            background: linear-gradient(45deg, #5352ed, #3742fa);
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-success {
            background: linear-gradient(45deg, #2ed573, #7bed9f);
            color: white;
        }

        .alert-danger {
            background: linear-gradient(45deg, #ff4757, #ff6b7a);
            color: white;
        }

        .alert-warning {
            background: linear-gradient(45deg, #ffa502, #ff6348);
            color: white;
        }

        .alert-info {
            background: linear-gradient(45deg, #3742fa, #5352ed);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .report-filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .report-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">
        <div class="sync-indicator" id="syncIndicator"></div>
        <span id="syncText">Ready</span>
        <button class="btn" onclick="manualSync()" style="padding: 5px 10px; font-size: 10px; margin: 0;">Sync</button>
    </div>

    <div class="container">
        <div class="header">
            <h1 style="text-align: center; margin-bottom: 20px; color: #333; font-size: 2.5em; font-weight: 700;">🎾 Padel Academy Management</h1>
            <div class="nav">
                <button class="nav-btn active" onclick="showPage('sessions')">Sessions</button>
                <button class="nav-btn" onclick="showPage('clients')">Clients</button>
                <button class="nav-btn" onclick="showPage('expenses')">Expenses</button>
                <button class="nav-btn" onclick="showPage('dashboard')">Dashboard</button>
                <button class="nav-btn" onclick="showPage('reports')">Reports</button>
                <button class="nav-btn" onclick="showPage('backup')">Backup</button>
            </div>
        </div>

        <!-- Sessions Page -->
        <div id="sessions" class="page active">
            <h2 style="margin-bottom: 30px; color: #333;">📋 Session Management</h2>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="btn" onclick="showAddSessionForm()">➕ Add New Session</button>
                <button class="btn btn-success" onclick="exportSessions()">📊 Export Sessions</button>
            </div>

            <div id="addSessionForm" class="hidden" style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px; color: #333;">Add New Session</h3>
                <form onsubmit="addSession(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="sessionDate" required>
                        </div>
                        <div class="form-group">
                            <label>Time:</label>
                            <input type="time" id="sessionTime" required>
                        </div>
                        <div class="form-group">
                            <label>Location:</label>
                            <select id="location" required>
                                <option value="">Select Location</option>
                                <option value="Top Padel">Top Padel</option>
                                <option value="Champs">Champs</option>
                                <option value="Padel Art">Padel Art</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group hidden" id="customLocationGroup">
                            <label>Custom Location:</label>
                            <input type="text" id="customLocation">
                        </div>
                        <div class="form-group">
                            <label>Session Type:</label>
                            <select id="sessionType" required>
                                <option value="">Select Type</option>
                                <option value="Group Session">Group Session</option>
                                <option value="Private">Private</option>
                                <option value="Networking">Networking</option>
                                <option value="Tournament">Tournament</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Duration (hours):</label>
                            <select id="duration" required>
                                <option value="">Select Duration</option>
                                <option value="0.5">30 minutes</option>
                                <option value="1">1 hour</option>
                                <option value="1.5">1.5 hours</option>
                                <option value="2">2 hours</option>
                                <option value="2.5">2.5 hours</option>
                                <option value="3">3 hours</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Instructor Name:</label>
                            <input type="text" id="instructorName" required>
                        </div>
                        <div class="form-group">
                            <label>Client:</label>
                            <select id="clientSelect" required onchange="handleClientSelection()">
                                <option value="">Select Client</option>
                                <option value="new_client">➕ Add New Client</option>
                            </select>
                        </div>
                        <div class="form-group hidden" id="newClientGroup">
                            <label>New Client Name:</label>
                            <input type="text" id="newClientName">
                        </div>
                        <div class="form-group">
                            <label>Payment Status:</label>
                            <select id="paymentStatus" required>
                                <option value="">Select Status</option>
                                <option value="Paid">Paid</option>
                                <option value="Pending">Pending</option>
                                <option value="Free Session">Free Session</option>
                                <option value="Canceled">Canceled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price per Hour:</label>
                            <input type="number" id="pricePerHour" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Number of Students:</label>
                            <input type="number" id="numberOfStudents" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>Court Cost per Hour:</label>
                            <input type="number" id="courtCostPerHour" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes:</label>
                        <textarea id="sessionNotes" rows="3"></textarea>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">💾 Save Session</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddSessionForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Session ID</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Client</th>
                            <th>Location</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Revenue</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sessionsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Clients Page -->
        <div id="clients" class="page">
            <h2 style="margin-bottom: 30px; color: #333;">👥 Client Management</h2>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="btn" onclick="showAddClientForm()">➕ Add New Client</button>
                <button class="btn btn-success" onclick="exportClients()">📊 Export Clients</button>
            </div>

            <div id="addClientForm" class="hidden" style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px; color: #333;">Add New Client</h3>
                <form onsubmit="addClient(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Client Name:</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="clientEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Phone:</label>
                            <input type="tel" id="clientPhone" required>
                        </div>
                        <div class="form-group">
                            <label>Lead Source:</label>
                            <select id="clientLeadSource">
                                <option value="Recurring Client">Recurring Client</option>
                                <option value="Social Media">Social Media</option>
                                <option value="Word of Mouth">Word of Mouth</option>
                                <option value="Website">Website</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes:</label>
                        <textarea id="clientNotes" rows="3"></textarea>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">💾 Save Client</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddClientForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Sessions</th>
                            <th>Total Spent</th>
                            <th>Lead Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Expenses Page -->
        <div id="expenses" class="page">
            <h2 style="margin-bottom: 30px; color: #333;">💰 Expenses</h2>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="btn" onclick="showAddExpenseForm()">➕ Add Expense</button>
                <button class="btn btn-success" onclick="exportExpenses()">📊 Export Expenses</button>
            </div>

            <div id="addExpenseForm" class="hidden" style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px; color: #333;">Add New Expense</h3>
                <form onsubmit="addExpense(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label>Category:</label>
                            <select id="expenseCategory" required>
                                <option value="">Select Category</option>
                                <option value="Court Rental">Court Rental</option>
                                <option value="Equipment">Equipment</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Transportation">Transportation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount (AED):</label>
                            <input type="number" id="expenseAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <input type="text" id="expenseDescription" required>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">💾 Save Expense</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddExpenseForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard" class="page">
            <h2 style="margin-bottom: 30px; color: #333;">📊 Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalSessions">0</div>
                    <div class="stat-label">Total Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">AED 0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProfit">AED 0</div>
                    <div class="stat-label">Net Profit</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Total Clients</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalExpenses">AED 0</div>
                    <div class="stat-label">Total Expenses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgRevenuePerSession">AED 0</div>
                    <div class="stat-label">Avg Revenue/Session</div>
                </div>
            </div>

            <div class="report-section">
                <h3>Quick Stats</h3>
                <div id="quickStats">
                    <!-- Quick stats will be populated here -->
                </div>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reports" class="page">
            <h2 style="margin-bottom: 30px; color: #333;">📈 Reports</h2>
            
            <div class="report-filters">
                <h3>Generate Reports</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Report Type:</label>
                        <select id="reportType">
                            <option value="monthly">Monthly Summary</option>
                            <option value="yearly">Yearly Summary</option>
                            <option value="financial">Financial Report</option>
                            <option value="client-analysis">Client Analysis</option>
                            <option value="location-analysis">Location Analysis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Year:</label>
                        <select id="reportYear">
                            <!-- Years will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Month (for monthly reports):</label>
                        <select id="reportMonth">
                            <option value="">All Months</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="generateReport()">📊 Generate Report</button>
                    <button class="btn btn-success" onclick="downloadReportPDF()" id="downloadBtn" style="display: none;">📄 Download PDF</button>
                </div>
            </div>

            <div id="reportResults" class="hidden">
                <div class="report-section">
                    <div id="reportContent">
                        <!-- Report content will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup Page -->
        <div id="backup" class="page">
            <h2 style="margin-bottom: 30px; color: #333;">💾 Backup & Export</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <h3>Data Backup</h3>
                    <p>Download a complete backup of all your data.</p>
                    <button class="btn" onclick="backupAllData()">📤 Download Backup</button>
                    <button class="btn btn-secondary" onclick="restoreData()">📥 Restore Data</button>
                    <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="handleRestore(event)">
                </div>
                
                <div class="form-group">
                    <h3>Export Options</h3>
                    <p>Export specific data sets as CSV files.</p>
                    <button class="btn" onclick="exportSessions()">📊 Export Sessions</button>
                    <button class="btn" onclick="exportClients()">👥 Export Clients</button>
                    <button class="btn" onclick="exportExpenses()">💰 Export Expenses</button>
                </div>
                
                <div class="form-group">
                    <h3>Data Management</h3>
                    <p>Manage your application data.</p>
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">⚠️ This will delete all data permanently!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let sessions = [];
        let clients = [];
        let expenses = [];
        let nextSessionId = 1;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setDefaultDates();
            setupEventListeners();
            populateYearDropdown();
        });

        function loadAllData() {
            sessions = JSON.parse(localStorage.getItem('sessions') || '[]');
            clients = JSON.parse(localStorage.getItem('clients') || '[]');
            expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
            nextSessionId = parseInt(localStorage.getItem('nextSessionId') || '1');
            
            loadSessions();
            loadClients();
            loadExpenses();
            populateClientDropdowns();
            updateDashboard();
        }

        function setDefaultDates() {
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            
            const sessionDate = document.getElementById('sessionDate');
            const expenseDate = document.getElementById('expenseDate');
            
            if (sessionDate) sessionDate.value = dateString;
            if (expenseDate) expenseDate.value = dateString;
        }

        function setupEventListeners() {
            const locationSelect = document.getElementById('location');
            if (locationSelect) {
                locationSelect.addEventListener('change', function() {
                    const customGroup = document.getElementById('customLocationGroup');
                    if (this.value === 'Other') {
                        customGroup.classList.remove('hidden');
                    } else {
                        customGroup.classList.add('hidden');
                    }
                });
            }
        }

        function populateYearDropdown() {
            const yearSelect = document.getElementById('reportYear');
            if (!yearSelect) return;
            
            yearSelect.innerHTML = '';
            const currentYear = new Date().getFullYear();
            
            // Add years from 2020 to current year + 1
            for (let year = 2020; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }

        // Save data to localStorage
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Generate session ID in PA-XXX format
        function generateSessionId() {
            const id = 'PA-' + String(nextSessionId).padStart(3, '0');
            nextSessionId++;
            saveData('nextSessionId', nextSessionId);
            return id;
        }

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update page-specific data
            if (pageId === 'dashboard') updateDashboard();
            if (pageId === 'reports') populateYearDropdown();
        }

        // Session Management
        function showAddSessionForm() {
            document.getElementById('addSessionForm').classList.remove('hidden');
            populateClientDropdowns();
        }

        function hideAddSessionForm() {
            document.getElementById('addSessionForm').classList.add('hidden');
            document.querySelector('#addSessionForm form').reset();
            document.getElementById('newClientGroup').classList.add('hidden');
            document.getElementById('customLocationGroup').classList.add('hidden');
            
            // Reset date to today
            setDefaultDates();
        }

        function handleClientSelection() {
            const clientSelect = document.getElementById('clientSelect');
            const newClientGroup = document.getElementById('newClientGroup');
            
            if (clientSelect.value === 'new_client') {
                newClientGroup.classList.remove('hidden');
            } else {
                newClientGroup.classList.add('hidden');
            }
        }

        function addSession(event) {
            event.preventDefault();
            
            let clientName;
            const clientSelect = document.getElementById('clientSelect');
            
            if (clientSelect.value === 'new_client') {
                clientName = document.getElementById('newClientName').value;
                if (!clientName) {
                    showAlert('Please enter client name', 'danger');
                    return;
                }
                
                // Create new client
                const newClient = {
                    id: Date.now(),
                    name: clientName,
                    email: '',
                    phone: '',
                    leadSource: 'New Client',
                    notes: 'Created from session',
                    createdDate: new Date().toISOString().split('T')[0]
                };
                clients.push(newClient);
                saveData('clients', clients);
                populateClientDropdowns();
            } else {
                clientName = clientSelect.value;
            }

            const location = document.getElementById('location').value === 'Other' 
                ? document.getElementById('customLocation').value 
                : document.getElementById('location').value;

            const session = {
                id: Date.now(),
                sessionId: generateSessionId(),
                date: document.getElementById('sessionDate').value,
                time: document.getElementById('sessionTime').value,
                location: location,
                sessionType: document.getElementById('sessionType').value,
                duration: parseFloat(document.getElementById('duration').value),
                instructorName: document.getElementById('instructorName').value,
                clientName: clientName,
                paymentStatus: document.getElementById('paymentStatus').value,
                pricePerHour: parseFloat(document.getElementById('pricePerHour').value),
                numberOfStudents: parseInt(document.getElementById('numberOfStudents').value),
                courtCostPerHour: parseFloat(document.getElementById('courtCostPerHour').value),
                notes: document.getElementById('sessionNotes').value,
                totalRevenue: 0,
                netProfit: 0
            };

            // Calculate financials
            calculateSessionFinancials(session);

            sessions.push(session);
            saveData('sessions', sessions);
            
            loadSessions();
            hideAddSessionForm();
            updateDashboard();
            showAlert('Session added successfully!', 'success');
        }

        function calculateSessionFinancials(session) {
            if (session.paymentStatus === 'Free Session' || session.paymentStatus === 'Canceled') {
                session.totalRevenue = 0;
            } else {
                session.totalRevenue = session.duration * session.pricePerHour;
            }
            
            const totalCourtCost = session.duration * session.courtCostPerHour;
            session.netProfit = session.totalRevenue - totalCourtCost;
        }

        function loadSessions() {
            const tbody = document.getElementById('sessionsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort sessions by date (newest first)
            const sortedSessions = [...sessions].sort((a, b) => {
                return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
            });
            
            sortedSessions.forEach(session => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${session.sessionId}</td>
                    <td>${formatDate(session.date)}</td>
                    <td>${session.time}</td>
                    <td>${session.clientName}</td>
                    <td>${session.location}</td>
                    <td>${session.sessionType}</td>
                    <td><span class="status-badge status-${session.paymentStatus.toLowerCase().replace(' ', '-')}">${session.paymentStatus}</span></td>
                    <td>AED ${session.totalRevenue.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteSession(${session.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        ${session.paymentStatus === 'Pending' ? 
                            `<button class="btn btn-success" onclick="markAsPaid(${session.id})" style="padding: 5px 10px; font-size: 12px;">Mark Paid</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function deleteSession(sessionId) {
            if (confirm('Delete this session?')) {
                sessions = sessions.filter(s => s.id !== sessionId);
                saveData('sessions', sessions);
                loadSessions();
                updateDashboard();
                showAlert('Session deleted!', 'success');
            }
        }

        function markAsPaid(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (session) {
                session.paymentStatus = 'Paid';
                calculateSessionFinancials(session);
                saveData('sessions', sessions);
                loadSessions();
                updateDashboard();
                showAlert('Session marked as paid!', 'success');
            }
        }

        // Client Management
        function showAddClientForm() {
            document.getElementById('addClientForm').classList.remove('hidden');
        }

        function hideAddClientForm() {
            document.getElementById('addClientForm').classList.add('hidden');
            document.querySelector('#addClientForm form').reset();
        }

        function addClient(event) {
            event.preventDefault();
            
            const client = {
                id: Date.now(),
                name: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                leadSource: document.getElementById('clientLeadSource').value,
                notes: document.getElementById('clientNotes').value,
                createdDate: new Date().toISOString().split('T')[0]
            };

            clients.push(client);
            saveData('clients', clients);
            
            loadClients();
            populateClientDropdowns();
            hideAddClientForm();
            updateDashboard();
            showAlert('Client added successfully!', 'success');
        }

        function loadClients() {
            const tbody = document.getElementById('clientsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            clients.forEach(client => {
                const clientSessions = sessions.filter(s => s.clientName === client.name);
                const totalSessions = clientSessions.length;
                const totalSpent = clientSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.email}</td>
                    <td>${client.phone}</td>
                    <td>${totalSessions}</td>
                    <td>AED ${totalSpent.toFixed(2)}</td>
                    <td>${client.leadSource}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteClient(${client.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function deleteClient(clientId) {
            if (confirm('Delete this client? This will not affect existing sessions.')) {
                clients = clients.filter(c => c.id !== clientId);
                saveData('clients', clients);
                loadClients();
                populateClientDropdowns();
                updateDashboard();
                showAlert('Client deleted!', 'success');
            }
        }

        function populateClientDropdowns() {
            const select = document.getElementById('clientSelect');
            if (!select) return;
            
            const currentValue = select.value;
            
            // Clear existing options except first two
            while (select.children.length > 2) {
                select.removeChild(select.lastChild);
            }
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.name;
                option.textContent = client.name;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        }

        // Expense Management
        function showAddExpenseForm() {
            document.getElementById('addExpenseForm').classList.remove('hidden');
        }

        function hideAddExpenseForm() {
            document.getElementById('addExpenseForm').classList.add('hidden');
            document.querySelector('#addExpenseForm form').reset();
            setDefaultDates();
        }

        function addExpense(event) {
            event.preventDefault();
            
            const expense = {
                id: Date.now(),
                date: document.getElementById('expenseDate').value,
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                description: document.getElementById('expenseDescription').value
            };

            expenses.push(expense);
            saveData('expenses', expenses);
            
            loadExpenses();
            hideAddExpenseForm();
            updateDashboard();
            showAlert('Expense added successfully!', 'success');
        }

        function loadExpenses() {
            const tbody = document.getElementById('expensesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort expenses by date (newest first)
            const sortedExpenses = [...expenses].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            sortedExpenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td>${expense.category}</td>
                    <td>${expense.description}</td>
                    <td>AED ${expense.amount.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteExpense(${expense.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function deleteExpense(expenseId) {
            if (confirm('Delete this expense?')) {
                expenses = expenses.filter(e => e.id !== expenseId);
                saveData('expenses', expenses);
                loadExpenses();
                updateDashboard();
                showAlert('Expense deleted!', 'success');
            }
        }

        // Dashboard
        function updateDashboard() {
            const totalSessions = sessions.length;
            const totalRevenue = sessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            const totalCourtCosts = sessions.reduce((sum, s) => sum + (s.duration * s.courtCostPerHour), 0);
            const totalExpensesAmount = expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalProfit = totalRevenue - totalCourtCosts - totalExpensesAmount;
            const totalClients = clients.length;
            const avgRevenuePerSession = totalSessions > 0 ? totalRevenue / totalSessions : 0;
            
            // Update stat cards
            const elements = {
                'totalSessions': totalSessions,
                'totalRevenue': `AED ${totalRevenue.toFixed(2)}`,
                'totalProfit': `AED ${totalProfit.toFixed(2)}`,
                'totalClients': totalClients,
                'totalExpenses': `AED ${totalExpensesAmount.toFixed(2)}`,
                'avgRevenuePerSession': `AED ${avgRevenuePerSession.toFixed(2)}`
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
            
            // Update quick stats
            updateQuickStats();
        }

        function updateQuickStats() {
            const quickStats = document.getElementById('quickStats');
            if (!quickStats) return;
            
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            
            const thisMonthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === thisMonth && sessionDate.getFullYear() === thisYear;
            });
            
            const thisMonthRevenue = thisMonthSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            const pendingSessions = sessions.filter(s => s.paymentStatus === 'Pending');
            const pendingRevenue = pendingSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            
            quickStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                        <h4>This Month</h4>
                        <p><strong>${thisMonthSessions.length}</strong> sessions</p>
                        <p><strong>AED ${thisMonthRevenue.toFixed(2)}</strong> revenue</p>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 10px;">
                        <h4>Pending Payments</h4>
                        <p><strong>${pendingSessions.length}</strong> sessions</p>
                        <p><strong>AED ${pendingRevenue.toFixed(2)}</strong> pending</p>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 10px;">
                        <h4>Most Active Client</h4>
                        <p><strong>${getMostActiveClient()}</strong></p>
                    </div>
                </div>
            `;
        }

        function getMostActiveClient() {
            if (clients.length === 0) return 'No clients yet';
            
            const clientSessionCounts = {};
            sessions.forEach(session => {
                clientSessionCounts[session.clientName] = (clientSessionCounts[session.clientName] || 0) + 1;
            });
            
            const mostActive = Object.entries(clientSessionCounts)
                .sort(([,a], [,b]) => b - a)[0];
            
            return mostActive ? `${mostActive[0]} (${mostActive[1]} sessions)` : 'No sessions yet';
        }

        // Reports
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const year = parseInt(document.getElementById('reportYear').value);
            const month = document.getElementById('reportMonth').value;
            
            if (!year) {
                showAlert('Please select a year', 'danger');
                return;
            }
            
            let reportHTML = '';
            
            switch (reportType) {
                case 'monthly':
                    reportHTML = generateMonthlyReport(year, month);
                    break;
                case 'yearly':
                    reportHTML = generateYearlyReport(year);
                    break;
                case 'financial':
                    reportHTML = generateFinancialReport(year);
                    break;
                case 'client-analysis':
                    reportHTML = generateClientAnalysisReport(year);
                    break;
                case 'location-analysis':
                    reportHTML = generateLocationAnalysisReport(year);
                    break;
            }
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            document.getElementById('reportResults').classList.remove('hidden');
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        function generateMonthlyReport(year, monthFilter) {
            const filteredSessions = sessions.filter(session => {
                const sessionDate = new Date(session.date);
                const sessionYear = sessionDate.getFullYear();
                const sessionMonth = sessionDate.getMonth() + 1;
                
                if (sessionYear !== year) return false;
                if (monthFilter && parseInt(monthFilter) !== sessionMonth) return false;
                
                return true;
            });
            
            if (monthFilter) {
                const monthName = new Date(year, parseInt(monthFilter) - 1, 1).toLocaleDateString('en-US', { month: 'long' });
                return generateSingleMonthReport(filteredSessions, monthName, year);
            } else {
                return generateAllMonthsReport(filteredSessions, year);
            }
        }

        function generateSingleMonthReport(sessions, monthName, year) {
            const totalSessions = sessions.length;
            const totalRevenue = sessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            const totalCosts = sessions.reduce((sum, s) => sum + (s.duration * s.courtCostPerHour), 0);
            
            return `
                <h3>${monthName} ${year} Report</h3>
                <div style="margin: 20px 0;">
                    <p><strong>Total Sessions:</strong> ${totalSessions}</p>
                    <p><strong>Total Revenue:</strong> AED ${totalRevenue.toFixed(2)}</p>
                    <p><strong>Court Costs:</strong> AED ${totalCosts.toFixed(2)}</p>
                    <p><strong>Gross Profit:</strong> AED ${(totalRevenue - totalCosts).toFixed(2)}</p>
                </div>
                ${generateSessionsTable(sessions)}
            `;
        }

        function generateAllMonthsReport(sessions, year) {
            const monthlyData = {};
            
            for (let i = 1; i <= 12; i++) {
                const monthName = new Date(year, i - 1, 1).toLocaleDateString('en-US', { month: 'long' });
                monthlyData[monthName] = sessions.filter(s => {
                    const sessionDate = new Date(s.date);
                    return sessionDate.getMonth() + 1 === i;
                });
            }
            
            let html = `<h3>Monthly Summary for ${year}</h3>`;
            html += '<table style="width: 100%; border-collapse: collapse; margin: 20px 0;"><thead><tr style="background: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd;">Month</th><th style="padding: 10px; border: 1px solid #ddd;">Sessions</th><th style="padding: 10px; border: 1px solid #ddd;">Revenue</th><th style="padding: 10px; border: 1px solid #ddd;">Gross Profit</th></tr></thead><tbody>';
            
            Object.entries(monthlyData).forEach(([month, sessionsData]) => {
                const revenue = sessionsData.reduce((sum, s) => sum + s.totalRevenue, 0);
                const costs = sessionsData.reduce((sum, s) => sum + (s.duration * s.courtCostPerHour), 0);
                const profit = revenue - costs;
                
                html += `<tr><td style="padding: 10px; border: 1px solid #ddd;">${month}</td><td style="padding: 10px; border: 1px solid #ddd;">${sessionsData.length}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${revenue.toFixed(2)}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${profit.toFixed(2)}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateYearlyReport(year) {
            const filteredSessions = sessions.filter(session => {
                return new Date(session.date).getFullYear() === year;
            });
            
            const totalRevenue = filteredSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            const totalCosts = filteredSessions.reduce((sum, s) => sum + (s.duration * s.courtCostPerHour), 0);
            const yearExpenses = expenses.filter(e => new Date(e.date).getFullYear() === year);
            const totalExpenses = yearExpenses.reduce((sum, e) => sum + e.amount, 0);
            const netProfit = totalRevenue - totalCosts - totalExpenses;
            
            return `
                <h3>Yearly Report for ${year}</h3>
                <div style="margin: 20px 0;">
                    <p><strong>Total Sessions:</strong> ${filteredSessions.length}</p>
                    <p><strong>Total Revenue:</strong> AED ${totalRevenue.toFixed(2)}</p>
                    <p><strong>Court Costs:</strong> AED ${totalCosts.toFixed(2)}</p>
                    <p><strong>Other Expenses:</strong> AED ${totalExpenses.toFixed(2)}</p>
                    <p><strong>Net Profit:</strong> AED ${netProfit.toFixed(2)}</p>
                    <p><strong>Average Revenue per Session:</strong> AED ${filteredSessions.length > 0 ? (totalRevenue / filteredSessions.length).toFixed(2) : '0.00'}</p>
                </div>
                ${generateSessionTypeBreakdown(filteredSessions)}
            `;
        }

        function generateFinancialReport(year) {
            const filteredSessions = sessions.filter(session => {
                return new Date(session.date).getFullYear() === year;
            });
            
            const paidSessions = filteredSessions.filter(s => s.paymentStatus === 'Paid');
            const pendingSessions = filteredSessions.filter(s => s.paymentStatus === 'Pending');
            const freeSessions = filteredSessions.filter(s => s.paymentStatus === 'Free Session');
            const canceledSessions = filteredSessions.filter(s => s.paymentStatus === 'Canceled');
            
            const totalRevenue = paidSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            const pendingRevenue = pendingSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
            
            return `
                <h3>Financial Report for ${year}</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                        <h4>Paid Sessions</h4>
                        <p>${paidSessions.length} sessions</p>
                        <p><strong>AED ${totalRevenue.toFixed(2)}</strong></p>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                        <h4>Pending Payments</h4>
                        <p>${pendingSessions.length} sessions</p>
                        <p><strong>AED ${pendingRevenue.toFixed(2)}</strong></p>
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                        <h4>Free Sessions</h4>
                        <p>${freeSessions.length} sessions</p>
                        <p><strong>AED 0.00</strong></p>
                    </div>
                    <div style="background: #ffebee; padding: 15px; border-radius: 8px;">
                        <h4>Canceled Sessions</h4>
                        <p>${canceledSessions.length} sessions</p>
                        <p><strong>AED 0.00</strong></p>
                    </div>
                </div>
            `;
        }

        function generateClientAnalysisReport(year) {
            const filteredSessions = sessions.filter(session => {
                return new Date(session.date).getFullYear() === year;
            });
            
            const clientData = {};
            filteredSessions.forEach(session => {
                if (!clientData[session.clientName]) {
                    clientData[session.clientName] = {
                        sessions: 0,
                        revenue: 0
                    };
                }
                clientData[session.clientName].sessions++;
                clientData[session.clientName].revenue += session.totalRevenue;
            });
            
            const sortedClients = Object.entries(clientData)
                .sort(([,a], [,b]) => b.revenue - a.revenue);
            
            let html = `<h3>Client Analysis for ${year}</h3>`;
            html += '<table style="width: 100%; border-collapse: collapse; margin: 20px 0;"><thead><tr style="background: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd;">Client</th><th style="padding: 10px; border: 1px solid #ddd;">Sessions</th><th style="padding: 10px; border: 1px solid #ddd;">Revenue</th><th style="padding: 10px; border: 1px solid #ddd;">Avg per Session</th></tr></thead><tbody>';
            
            sortedClients.forEach(([client, data]) => {
                const avgPerSession = data.sessions > 0 ? data.revenue / data.sessions : 0;
                html += `<tr><td style="padding: 10px; border: 1px solid #ddd;">${client}</td><td style="padding: 10px; border: 1px solid #ddd;">${data.sessions}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${data.revenue.toFixed(2)}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${avgPerSession.toFixed(2)}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateLocationAnalysisReport(year) {
            const filteredSessions = sessions.filter(session => {
                return new Date(session.date).getFullYear() === year;
            });
            
            const locationData = {};
            filteredSessions.forEach(session => {
                if (!locationData[session.location]) {
                    locationData[session.location] = {
                        sessions: 0,
                        revenue: 0
                    };
                }
                locationData[session.location].sessions++;
                locationData[session.location].revenue += session.totalRevenue;
            });
            
            const sortedLocations = Object.entries(locationData)
                .sort(([,a], [,b]) => b.sessions - a.sessions);
            
            let html = `<h3>Location Analysis for ${year}</h3>`;
            html += '<table style="width: 100%; border-collapse: collapse; margin: 20px 0;"><thead><tr style="background: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd;">Location</th><th style="padding: 10px; border: 1px solid #ddd;">Sessions</th><th style="padding: 10px; border: 1px solid #ddd;">Revenue</th><th style="padding: 10px; border: 1px solid #ddd;">Avg per Session</th></tr></thead><tbody>';
            
            sortedLocations.forEach(([location, data]) => {
                const avgPerSession = data.sessions > 0 ? data.revenue / data.sessions : 0;
                html += `<tr><td style="padding: 10px; border: 1px solid #ddd;">${location}</td><td style="padding: 10px; border: 1px solid #ddd;">${data.sessions}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${data.revenue.toFixed(2)}</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${avgPerSession.toFixed(2)}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateSessionsTable(sessions) {
            if (sessions.length === 0) return '<p>No sessions found for this period.</p>';
            
            let html = '<table style="width: 100%; border-collapse: collapse; margin: 20px 0;"><thead><tr style="background: #f5f5f5;"><th style="padding: 8px; border: 1px solid #ddd;">Date</th><th style="padding: 8px; border: 1px solid #ddd;">Client</th><th style="padding: 8px; border: 1px solid #ddd;">Location</th><th style="padding: 8px; border: 1px solid #ddd;">Type</th><th style="padding: 8px; border: 1px solid #ddd;">Revenue</th></tr></thead><tbody>';
            
            sessions.forEach(session => {
                html += `<tr><td style="padding: 8px; border: 1px solid #ddd;">${formatDate(session.date)}</td><td style="padding: 8px; border: 1px solid #ddd;">${session.clientName}</td><td style="padding: 8px; border: 1px solid #ddd;">${session.location}</td><td style="padding: 8px; border: 1px solid #ddd;">${session.sessionType}</td><td style="padding: 8px; border: 1px solid #ddd;">AED ${session.totalRevenue.toFixed(2)}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateSessionTypeBreakdown(sessions) {
            const typeData = {};
            sessions.forEach(session => {
                if (!typeData[session.sessionType]) {
                    typeData[session.sessionType] = {
                        count: 0,
                        revenue: 0
                    };
                }
                typeData[session.sessionType].count++;
                typeData[session.sessionType].revenue += session.totalRevenue;
            });
            
            let html = '<h4>Session Type Breakdown</h4>';
            html += '<table style="width: 100%; border-collapse: collapse; margin: 15px 0;"><thead><tr style="background: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd;">Type</th><th style="padding: 10px; border: 1px solid #ddd;">Count</th><th style="padding: 10px; border: 1px solid #ddd;">Percentage</th><th style="padding: 10px; border: 1px solid #ddd;">Revenue</th></tr></thead><tbody>';
            
            const totalSessions = sessions.length;
            Object.entries(typeData).forEach(([type, data]) => {
                const percentage = totalSessions > 0 ? ((data.count / totalSessions) * 100).toFixed(1) : 0;
                html += `<tr><td style="padding: 10px; border: 1px solid #ddd;">${type}</td><td style="padding: 10px; border: 1px solid #ddd;">${data.count}</td><td style="padding: 10px; border: 1px solid #ddd;">${percentage}%</td><td style="padding: 10px; border: 1px solid #ddd;">AED ${data.revenue.toFixed(2)}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function downloadReportPDF() {
            const reportContent = document.getElementById('reportContent');
            if (!reportContent || !reportContent.innerHTML.trim()) {
                showAlert('Please generate a report first', 'warning');
                return;
            }
            
            const reportType = document.getElementById('reportType').value;
            const year = document.getElementById('reportYear').value;
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Padel Academy Report</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.4;
                        }
                        table { 
                            border-collapse: collapse; 
                            width: 100%; 
                            margin: 20px 0; 
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #f2f2f2; 
                            font-weight: bold;
                        }
                        h3, h4 { 
                            color: #333; 
                            margin: 20px 0 10px 0;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid #333;
                        }
                        .footer {
                            margin-top: 50px;
                            padding-top: 20px;
                            border-top: 1px solid #ccc;
                            font-size: 12px;
                            color: #666;
                            text-align: center;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>🎾 Padel Academy Management System</h1>
                        <h2>Report Generated: ${new Date().toLocaleDateString()}</h2>
                    </div>
                    ${reportContent.innerHTML}
                    <div class="footer">
                        Generated on ${new Date().toLocaleString()} | Padel Academy Management System
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `padel_report_${reportType}_${year}_${Date.now()}.html`;
            link.click();
            
            showAlert('Report downloaded as HTML (can be printed as PDF from browser)!', 'success');
        }

        // Export functions
        function exportSessions() {
            if (sessions.length === 0) {
                showAlert('No sessions to export', 'warning');
                return;
            }
            
            const csv = 'Session ID,Date,Time,Client,Location,Type,Status,Price/Hour,Duration,Revenue,Notes\n' +
                sessions.map(s => `"${s.sessionId}","${s.date}","${s.time}","${s.clientName}","${s.location}","${s.sessionType}","${s.paymentStatus}","${s.pricePerHour}","${s.duration}","${s.totalRevenue}","${s.notes || ''}"`).join('\n');
            
            downloadCSV(csv, 'sessions_export.csv');
            showAlert('Sessions exported successfully!', 'success');
        }

        function exportClients() {
            if (clients.length === 0) {
                showAlert('No clients to export', 'warning');
                return;
            }
            
            const csv = 'Name,Email,Phone,Lead Source,Total Sessions,Total Spent,Created Date,Notes\n' +
                clients.map(c => {
                    const clientSessions = sessions.filter(s => s.clientName === c.name);
                    const totalSpent = clientSessions.reduce((sum, s) => sum + s.totalRevenue, 0);
                    return `"${c.name}","${c.email}","${c.phone}","${c.leadSource}","${clientSessions.length}","${totalSpent.toFixed(2)}","${c.createdDate}","${c.notes || ''}"`;
                }).join('\n');
            
            downloadCSV(csv, 'clients_export.csv');
            showAlert('Clients exported successfully!', 'success');
        }

        function exportExpenses() {
            if (expenses.length === 0) {
                showAlert('No expenses to export', 'warning');
                return;
            }
            
            const csv = 'Date,Category,Description,Amount\n' +
                expenses.map(e => `"${e.date}","${e.category}","${e.description}","${e.amount.toFixed(2)}"`).join('\n');
            
            downloadCSV(csv, 'expenses_export.csv');
            showAlert('Expenses exported successfully!', 'success');
        }

        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Backup functions
        function backupAllData() {
            const data = {
                sessions,
                clients,
                expenses,
                nextSessionId,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `padel_academy_backup_${new Date().toISOString().split('T')[0].replace(/-/g, '_')}.json`;
            link.click();
            
            showAlert('Backup downloaded successfully!', 'success');
        }

        function restoreData() {
            document.getElementById('restoreFile').click();
        }

        function handleRestore(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Continue?')) {
                        sessions = data.sessions || [];
                        clients = data.clients || [];
                        expenses = data.expenses || [];
                        nextSessionId = data.nextSessionId || 1;
                        
                        saveData('sessions', sessions);
                        saveData('clients', clients);
                        saveData('expenses', expenses);
                        saveData('nextSessionId', nextSessionId);
                        
                        loadAllData();
                        showAlert('Data restored successfully!', 'success');
                    }
                } catch (error) {
                    showAlert('Error reading backup file: ' + error.message, 'danger');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            if (confirm('This will delete ALL data permanently. Are you sure?')) {
                if (confirm('Last chance! This cannot be undone.')) {
                    sessions = [];
                    clients = [];
                    expenses = [];
                    nextSessionId = 1;
                    
                    localStorage.clear();
                    
                    loadAllData();
                    showAlert('All data cleared!', 'success');
                }
            }
        }

        // Utility functions
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '80px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.maxWidth = '300px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Manual sync function (placeholder for cloud sync)
        function manualSync() {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncText');
            
            indicator.className = 'sync-indicator syncing';
            text.textContent = 'Syncing...';
            
            // Simulate sync process
            setTimeout(() => {
                indicator.className = 'sync-indicator connected';
                text.textContent = `Synced ${new Date().toLocaleTimeString()}`;
                showAlert('Data synced successfully!', 'success');
            }, 2000);
        }

        // Initialize sync status
        function initSyncStatus() {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncText');
            
            if (navigator.onLine) {
                indicator.className = 'sync-indicator connected';
                text.textContent = 'Ready';
            } else {
                indicator.className = 'sync-indicator';
                text.textContent = 'Offline';
            }
        }

        // Listen for online/offline events
        window.addEventListener('online', function() {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncText');
            indicator.className = 'sync-indicator connected';
            text.textContent = 'Back Online';
        });

        window.addEventListener('offline', function() {
            const indicator = document.getElementById('syncIndicator');
            const text = document.getElementById('syncText');
            indicator.className = 'sync-indicator';
            text.textContent = 'Offline';
        });

        // Initialize sync status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initSyncStatus, 100);
        });
    </script>
</body>
</html>